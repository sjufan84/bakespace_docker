<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
    crossorigin="anonymous">
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <title id="title">BakeBot</title>
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakeBot - Your Ultimate Kitchen Companion</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* You can add custom styles here if needed to match the exact colors/fonts etc. */
        .btn-custom-green {
            background-color: #7CBCA6; /* Custom green color */
            border-color: #7CBCA6;
            color: white;
        }
        .btn-custom-red {
            background-color: #b05e5d; /* Custom red color */
            border-color: #b05e5d;
            color: white;
        }
    </style>
</head>
<body>
    <body>
        <div class="container my-5">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h1 class="h2 font-weight-bold mb-3">Introducing BakeBot -- your ultimate kitchen companion!</h1>
                    <p>Our fun and intelligent AI kitchen assistant is here to make cooking a breeze.
                      Create new recipes, customize existing ones, and even upload your own recipes
                      or recipe cards! You can ask questions with just one click. With "BakeBot,"
                      you’ll never wonder “what’s for dinner” again!</p>
                </div>
            </div>
    
            <h2 class="h3 font-weight-bold mb-3">Let's get cooking!</h2>
            <div class="row">
                <div class="col-12 mb-3">
                    <textarea class="form-control" id="userQuestion" rows="5" placeholder=
                    "If you would like to create a new recipe, simply tell BakeBot what type of recipe
                    you are looking for, any dietary restrictions, and any other specifications, and
                    let the magic begin!  After your recipe is generated, you will also have the chance to ask
                    questions about it, adjust it, and even generate pairings!  Feel free to ask 
                    any other general cooking questions you may have.  BakeBot is here to help!"></textarea>
                </div>
                <div class="col-12 mb-3">
                    <div id="select-buttons-group">
                    <label>Chef Style:</label>
                    <div id="chefStyleButtons" class="btn-group mb-3" role="group" aria-label="Chef Style">
                      <button type="button" class="btn btn-secondary ml-2" value="Home Cook">Home Cook</button>
                      <button type="button" class="btn btn-secondary ml-2" value="Pro Chef">Pro Chef</button>
                      <button type="button" class="btn btn-secondary ml-2" value="Snarky Fun Chef">Snarky Fun Chef</button>
                  </div>
                </div>
                <div class="col-12 mb-1">
                    <label>Serving Size:</label>
                    <div id="servingSizeButtons" class="btn-group" role="group" aria-label="Serving Size">
                      <button type="button" class="btn btn-secondary ml-2" value="Just Me">Just Me</button>
                      <button type="button" class="btn btn-secondary ml-2" value="For Two">For Two</button>
                      <button type="button" class="btn btn-secondary ml-2" value="Family-Size">Family-Size</button>
                      <button type="button" class="btn btn-secondary ml-2" value="Potluck-Size">Potluck-Size</button>
                    </div>
                </div>
            </div>
                <div class="col-12 mb-3">
                    <button id="askBakeBot" class="btn btn-custom-green w-25 bg-inherit mb-4">ASK BAKEBOT</button>
                </div>
            </div>
    
            <h2 class="h3 font-weight-bold mb-3">Upload a Recipe / Scan a Photo</h2>
            <div class="row">
                <div class="col-12 mb-3">
                    <textarea class="form-control" rows="5" placeholder="Paste the text of your recipe here or upload it below.
                    You can upload a text file, pdf file, or even an image of a recipe card! Even if it is handwritten,
                    we can extract the relevant text and format it in a way to use it on BakeSpace just like any other recipe.
                    BakeBot will do its best to fill in the blanks if there is something missing on the recipe card, and you
                    will have the chance to review and edit the recipe before it is published."></textarea>
                </div>
                <!--- Create a row for the file uploader and the upload recipe button -->
                <div id = "uploadFilesRow" class = "align-content-center">
                <div class="col-md-4 mb-3">
                  <label for="formFileMultiple" class="form-label"></label>
                  <input class="form-control" type="file" id="formFileMultiple" multiple>
                </div>
                
                <div class="col-md-4 mb-3">
                    <button id="uploadButton" class="btn btn-custom-red">Or Upload Recipe</button>
                </div>
            </div>
            </div>
          </div>

<script>
  // Function to handle chef style button clicks
  document.querySelectorAll('#chefStyleButtons button').forEach(button => {
      button.addEventListener('click', function() {
          // Remove highlighting from all chef style buttons
          document.querySelectorAll('#chefStyleButtons button').forEach(btn => btn.classList.remove('btn-secondary'));
          // Highlight the selected button
          this.classList.add('btn-secondary');
          // Store the selected chef style
          document.chefStyle = this.value;
      });
  });

  // Function to handle serving size button clicks
  document.querySelectorAll('#servingSizeButtons button').forEach(button => {
      button.addEventListener('click', function() {
          // Remove highlighting from all serving size buttons
          document.querySelectorAll('#servingSizeButtons button').forEach(btn => btn.classList.remove('btn-secondary'));
          // Highlight the selected button
          this.classList.add('btn-secondary');
          // Store the selected serving size
          document.servingSize = this.value;
      });
  });

  document.getElementById('askBakeBot').addEventListener('click', function() {
      let question = document.getElementById('userQuestion').value;
      let chefStyle = document.chefStyle; // Use the stored chef style
      let servingSize = document.servingSize; // Use the stored serving size

    // Convert the frontend chef style to match the backend model's expected values
    let chefType;
    if (chefStyle === "Home Cook") {
        chefType = "home_cook";
    }
    else if (chefStyle === "Pro Chef") {
        chefType = "pro_chef";
    }
    else {
        chefType = "adventurous_chef";
    }
    message_content = question + " " + "Serving Size: " + servingSize + " "
    console.log(JSON.stringify({
            "message_content": question,
            "chef_type": chefType, // Ensure this matches 'chef_type' in the Pydantic model
            "serving_size": servingSize
        }));
    // Send this data to FastAPI backend
    fetch('http://localhost:8000/create_thread_run', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            "message_content": question,
            "chef_type": chefType, // Ensure this matches 'chef_type' in the Pydantic model
            "serving_size": servingSize
        })
    }
    ).then(response => response.json())
    .then(data => {
      localStorage.setItem('recipeData', data);
      // Redirect to the display page with the token as a query parameter
      window.location.href = `test2.html`;
    })
    .catch(error => console.error('Error:', error))
  });

document.getElementById('uploadButton').addEventListener('click', function() {
  console.log("upload button clicked");
    let fileInput = document.getElementById('formFileMultiple');
    let formData = new FormData();
    let sessionId = '12345'
    // Send the files to the backend
    formData.append('files', fileInput.files[0]);
    fetch('http://localhost:8000/upload-files/', {
        method: 'POST',
        body: formData,
        headers: {
            'session-id': sessionId
        }

    })
    .then(response => response.json())
    .then(data => {
      // Handle response
      //localStorage.setItem('uploadData', data);
      // Display the data on the page
      console.log(data);
      // Redirect to the display page with the token as a query parameter
      //window.location.href = `test2.html`;
    })
    .catch(error => console.error('Error:', error));
});

</script>
</body>
</html>