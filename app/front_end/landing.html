<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
    crossorigin="anonymous">
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <title id="title">BakeBot</title>
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakeBot - Your Ultimate Kitchen Companion</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* You can add custom styles here if needed to match the exact colors/fonts etc. */
        .btn-custom-green {
            background-color: #7CBCA6; /* Custom green color */
            border-color: #7CBCA6;
            color: white;
        }
        .btn-custom-red {
            background-color: #b05e5d; /* Custom red color */
            border-color: #b05e5d;
            color: white;
        }
        #funFactsContainer {
          font-size: 20px;
          font-weight: bold;
        }
    </style>
</head>
<body>
  <div class="container my-5">
    <!-- Introducing BakeBot Section -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h2 class="h2 font-weight-bold mb-3">Introducing BakeBot -- your ultimate kitchen companion!</h2>
            <p>Our fun and intelligent AI kitchen assistant is here to make cooking a breeze. Create new recipes, customize existing ones, and even upload your own recipes or recipe cards! You can ask questions with just one click. With "BakeBot," you‚Äôll never wonder ‚Äúwhat‚Äôs for dinner‚Äù again!</p>
        </div>
    </div>
    <!-- Create a recipe from scratch Section -->
    <h3 class="h3 font-weight-bold mb-3">Create a recipe from scratch:</h3>
    <div class="row mb-3">
      <div class="col-md-12 mb-1">
        <textarea class="form-control text-left" id="userQuestion" rows="4"
         placeholder="If you would like to create a new recipe, simply tell BakeBot what type of recipe you are looking for, any dietary restrictions, and any other specifications, and let the magic begin! After your recipe is generated, you will also have the chance to ask questions about it, adjust it, and even generate pairings! Feel free to ask any other general cooking questions you may have. BakeBot is here to help!"></textarea>
      </div>
    </div>
    <!-- Chef Style Buttons Section -->
    <div class="row mb-3">
      <div class="col-md-12 mb-1">
        <label class="mr-3">Chef Style:</label>
        <div id="chefStyleButtons" class="btn-group" role="group" aria-label="Chef Style">
            <button type="button" class="btn btn-secondary" value="Home Cook">Home Cook</button>
            <button type="button" class="btn btn-secondary ml-2" value="Pro Chef">Pro Chef</button>
            <button type="button" class="btn btn-secondary ml-2" value="Snarky Fun Chef">Snarky Fun Chef</button>
        </div>
      </div>
    </div>
      <!-- Serving Size Buttons Section -->
      <div class="row mb-3">
        <div class="col-md-12 mb-1">
          <label class="mr-3">Serving Size:</label>
          <div id="servingSizeButtons" class="btn-group" role="group" aria-label="Serving Size">
            <button type="button" class="btn btn-secondary" value="Just Me">Just Me</button>
            <button type="button" class="btn btn-secondary ml-2" value="For Two">For Two</button>
            <button type="button" class="btn btn-secondary ml-2" value="Family-Size">Family-Size</button>
            <button type="button" class="btn btn-secondary ml-2" value="Potluck-Size">Potluck-Size</button>
          </div>
        </div>
      </div>
      <!-- Ask BakeBot Button Section -->
      <div class="row mb-3">
        <div class="col-md-6">
            <button id="askBakeBot" class="btn btn-custom-green mb-4">ASK BAKEBOT</button>
        </div>
      <div id="funFactsRow" class="col-md-6 d-flex align-self-start align-items-start">
        <div id="funFactsContainer" class="align-self-start" style="display: none;">
          <!-- Fun facts will appear here -->
          While Chef is working, did you know... <span id="funFacts"></span>
        </div>
        <div class="spinner-border text-primary align-self-start ml-3 mb-6" role="status" id="bbSpinner" style="display: none;">
          <span class="sr-only">BakeBot is working...</span>
        </div>
      </div>
    </div>
    <!-- Or upload a recipe / scan a photo Section -->
    <div id="uploadRecipeSection" class="mb-5">
      <h3 class="h3 font-weight-bold mb-3">Or upload a recipe / scan a photo:</h3>
      <div class="row mb-3">
        <div class="col-md-12">
          <textarea class="form-control" rows="3" placeholder="You can either paste the recipe text of your recipe in this box, or upload the recipe below. Uploaded recipes can be in the format of a text file, pdf, or an image file. Once uploaded, the text will be extracted and formatted, and you will have the chance to make edits as well as ask BakeBot any questions you may have about the recipe."></textarea>
        </di>
      </div>
      <!-- File Uploader Section -->
      <div class="row align-items-center mt-3">
        <div class="col-md-4 mb-3">
            <input class="form-control" type="file" id="formFileMultiple" multiple>
        </div>
        <div class="col-md-4 mb-3">
            <button id="uploadButton" class="btn btn-custom-green">Upload Recipe</button>
        </div>
      </div>
    </div>
    <h3 class="h3 font-weight-bold mb-3">Find Recipes from Your Ingredients:</h3>
    <div class="row mb-3">
        <div class="col-md-12">
            <textarea class="form-control" rows="3" placeholder="Snap a picture of your pantry or fridge, or upload images of your ingredients, and let BakeBot suggest recipes based on what you have!"></textarea>
        </div>
    </div>
    <div class="row align-items-center">
        <div class="col-md-4 mb-3">
            <input class="form-control" type="file" id="ingredientImageInput" accept="image/*" capture="environment" multiple style="display: none;">
            <button id="cameraButton" class="btn btn-custom-green">üì∑ Snap a Picture</button>
            <button id="uploadButton" class="btn btn-custom-red">Upload Images</button>
        </div>
        <div class="col-md-4 mb-3">
            <button id="findRecipesButton" class="btn btn-custom-green">Find Recipes</button>
        </div>
    </div>
    <div id="imagePreview" class="col-md-12 mb-3"></div>
    <div class="spinner-border text-primary" role="status" id="ingredientSpinner" style="display: none;">
        <span class="sr-only">Processing...</span>
    </div>
    <div id="ingredientConfirmationSection" style="display:none;">
      <h3 class="h3 font-weight-bold mb-3">Confirm Your Ingredients:</h3>
      <div class="row mb-3">
        <div class="col-md-12">
          <ul id="detectedIngredientsList" class="list-group">
              <!-- Dynamically filled with detected ingredients -->
          </ul>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-12">
            <button id="editIngredientsButton" class="btn btn-custom-red">Edit Ingredients</button>
        </div>
      </div>
      <div id="recipeSpecificationsSection" class="mb-3" style="display:none;">
        <h3 class="h3 font-weight-bold mb-3">Specify Your Recipe Preferences:</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="recipePreferencesInput" placeholder="E.g., Vegan, Gluten-free, Low-carb">
            </div>
            <div class="col-md-6 mb-3">
                <button id="generateRecipeButton" class="btn btn-custom-green">Generate Recipe</button>
            </div>
        </div>
    </div>
    
    </div>
  </div>
<script>
  let funFacts = [];

  // Function to fetch and parse the CSV file
  function loadFunFacts() {
      fetch('../../resources/cooking_fun_facts.csv')
          .then(response => response.text())
          .then(text => {
              const lines = text.split('\n');
              // Skip the header, start from line 1
              for (let i = 1; i < lines.length; i++) {
                  if (lines[i].trim() !== '') {
                      funFacts.push(lines[i].trim());
                  }
              }
          });
  }

// Call this function when your app loads
loadFunFacts();


  // Function to handle chef style button clicks
  document.querySelectorAll('#chefStyleButtons button').forEach(button => {
      button.addEventListener('click', function() {
          // Remove highlighting from all chef style buttons
          document.querySelectorAll('#chefStyleButtons button').forEach(btn => btn.classList.remove('btn-secondary'));
          // Highlight the selected button
          this.classList.add('btn-secondary');
          // Store the selected chef style
          document.chefStyle = this.value;
      });
  });

  // Function to handle serving size button clicks
  document.querySelectorAll('#servingSizeButtons button').forEach(button => {
      button.addEventListener('click', function() {
          // Remove highlighting from all serving size buttons
          document.querySelectorAll('#servingSizeButtons button').forEach(btn => btn.classList.remove('btn-secondary'));
          // Highlight the selected button
          this.classList.add('btn-secondary');
          // Store the selected serving size
          document.servingSize = this.value;
      });
  });

  document.getElementById('askBakeBot').addEventListener('click', function() {
    let question = document.getElementById('userQuestion').value;
    let chefStyle = document.chefStyle; // Use the stored chef style
    let servingSize = document.servingSize; // Use the stored serving size

    // Convert the frontend chef style to match the backend model's expected values
    let chefType;
    if (chefStyle === "Home Cook") {
        chefType = "home_cook";
    }
    else if (chefStyle === "Pro Chef") {
        chefType = "pro_chef";
    }
    else {
        chefType = "adventurous_chef";
    }
    message_content = question + " " + "Serving Size: " + servingSize + " "
    console.log(JSON.stringify({
            "message_content": question,
            "chef_type": chefType, // Ensure this matches 'chef_type' in the Pydantic model
            "serving_size": servingSize
        }));
     // Hide the button
     this.style.display = 'none';

    // Show and start fun facts
    startFunFacts();
    // Show the spinner
    document.getElementById('bbSpinner').style.display = 'block';

    // Send this data to FastAPI backend
    fetch('http://localhost:8000/create_thread_run', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            "message_content": question,
            "chef_type": chefType, // Ensure this matches 'chef_type' in the Pydantic model
            "serving_size": servingSize
        })
    }
    ).then(response => response.json())
    .then(data => {
      localStorage.setItem('recipeData', data);
      localStorage.setItem('recipeType', 'new')
      // Redirect to the display page with the token as a query parameter
      window.location.href = `display.html`;
      // Hide the spinner
      document.getElementById('bbSpinner').style.display = 'none';
    })
    .catch(error => console.error('Error:', error))
    .finally(() => {
      // Stop fun facts
      stopFunFacts();
      document.getElementById('bbSpinner').style.display = 'none';
    });
  });

document.getElementById('uploadButton').addEventListener('click', function() {
  console.log("upload button clicked");
  // If the recipe is in the text area, add it to the form data
  let recipeText = document.getElementById('userQuestion').value;
  if (recipeText.trim() !== '') {
      let formData = new FormData();
      formData.append('recipe_text', recipeText);
      // Send the recipe text to the backend
      fetch('http://localhost:8000/format-recipe', {
          method: 'POST',
          body: formData,
      })
      .then(response => response.json())
      .then(data => {
        // Update the uploadedRecipeData variable
        localStorage.setItem('recipeData', data);
        localStorage.setItem('recipeType', 'uploaded');
        console.log(data);
        // Redirect to the display page with the token as a query parameter
        window.location.href = `display.html`;
      })
      .catch(error => console.error('Error:', error))
      .finally(() => {
        // Stop fun facts
        stopFunFacts();
        document.getElementById('bbSpinner').style.display = 'none';
      });
      // If there are files instead of text, add them to the form data
  } else if (document.getElementById('formFileMultiple').files.length > 0) {
      let formData = new FormData();
      for (let i = 0; i < document.getElementById('formFileMultiple').files.length; i++) {
          formData.append('files', document.getElementById('formFileMultiple').files[i]);
      }
      // Send the files to the backend
      fetch('http://localhost:8000/upload-files/', {
          method: 'POST',
          body: formData,
      })
      .then(response => response.json())
      .then(data => {
        // Update the uploadedRecipeData variable
        localStorage.setItem('recipeData', data);
        localStorage.setItem('recipeType', 'uploaded');
        console.log(data);
        // Redirect to the display page with the token as a query parameter
        window.location.href = `display.html`;
      })
      .catch(error => console.error('Error:', error))
      .finally(() => {
        // Stop fun facts
        stopFunFacts();
        document.getElementById('bbSpinner').style.display = 'none';
      });
    }
  });

  let funFactInterval;
  let currentFactIndex = 0;

  function startFunFacts() {
      // Show fun facts container
      const funFactsContainer = document.getElementById('funFactsContainer');
      funFactsContainer.style.display = 'block';

      // Start cycling through fun facts
      funFactInterval = setInterval(() => {
          if (funFacts.length > 0) {
              currentFactIndex = Math.floor(Math.random() * funFacts.length);
              funFactsContainer.textContent = funFacts[currentFactIndex];
          }
      }, 6000); // Change fun fact every 3 seconds
  }

  function stopFunFacts() {
      clearInterval(funFactInterval);
      document.getElementById('funFactsContainer').style.display = 'none';
      // Show the button again
      document.getElementById('askBakeBot').style.display = 'block';
      document.getElementById('uploadButton').style.display = 'block';
  }

// --------------------------------- Ingredient Detection --------------------------------- //
document.getElementById('cameraButton').addEventListener('click', () => {
    // Trigger the file input click for camera capture
    document.getElementById('ingredientImageInput').click();
});

document.getElementById('uploadButton').addEventListener('click', () => {
    // Trigger the file input click for uploading images
    document.getElementById('ingredientImageInput').click();
});

document.getElementById('ingredientImageInput').addEventListener('change', (event) => {
    if (event.target.files.length > 0) {
        const files = event.target.files;
        // Process files for preview or send them to the backend...
    }
});

document.getElementById('findRecipesButton').addEventListener('click', async () => {
    const inputElement = document.getElementById('ingredientImageInput');
    const files = inputElement.files;

    if (files.length > 0) {
        const formData = new FormData();
        for (const file of files) {
            formData.append('files', file);
        }

        // Send the request to the backend
        const response = await fetch('http://<your-server>/upload-images', {
            method: 'POST',
            body: formData
        });

        // Handle the response
        const result = await response.json();
        console.log(result);
    }
});


</script>
</body>
</html>